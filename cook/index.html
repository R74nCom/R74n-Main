<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
<!--
⢠⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣄⣀⣀⠄⠄⠄⠄⠄⠄⠄⠄⣀⣀⣀⣀⣀⣀⣀⡀
⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣆⡀⠄⠄⠄⠄⠿⠿⠿⠿⢿⣿⣿⠇
⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⠄⠄⠄⠄⠄⠄⠄⣠⣿⡿⠁⠄
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠄⠄⠄⠈⠹⣿⣿⣿⣿⣧⠄⠄⠄⠄⠄⣰⣿⡿⠁⠄⠄
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠄⠄⠄⠄⠄⣿⣿⣿⣿⣿⠄⠄⠄⠄⢀⣿⣿⠇⠄⠄⠄
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠄⠄⠄⠄⢀⣿⣿⣿⣿⡟⠄⠄⠄⠄⠘⠛⠛⢀⣀⣀⠄
⢸⣿⣿⣿⣿⣤⣤⣤⣤⣤⣤⣤⣶⣾⣿⣿⣿⡿⠄⠄⠄⠄⠄⠄⢀⣴⣿⣿⣿⠄
⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠋⠄⠄⠄⠄⠄⠄⣠⣿⠟⢹⣿⣿⠄
⢸⣿⣿⣿⣿⠿⠿⠿⣿⣿⣿⣿⣯⣍⠁⠄⠄⠄⠄⠄⠄⢀⣾⣿⣉⣀⣸⣿⣿⣀
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠙⢿⣿⣿⣿⣷⣄⠄⠄⠄⠄⠄⠸⠿⠿⠿⠿⢿⣿⣿⠿
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠄⠈⣿⣿⣿⣿⣿⣆⠄⠄⠄⠄⠄⠄⠄⠄⠄⠸⠿⠿⠄
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠄⠄⠈⢿⣿⣿⣿⣿⣇⠄⠄⠄⠄⣿⣿⣧⣾⣿⣿⣷⡀
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠄⠄⠄⠈⢻⣿⣿⣿⣿⣦⠄⠄⠄⣿⣿⡏⠄⢸⣿⣿⡇
⢸⣿⣿⣿⣿⠄⠄⠄⠄⠄⠄⠄⠄⠄⢿⣿⣿⣿⣿⣆⠄⠄⣿⣿⡇⠄⢸⣿⣿⡇
⠘⠛⠛⠛⠛⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠛⠛⠛⠛⠛⠃⠄⠛⠛⠃⠄⠘⠛⠛⠃
This HTML and its contents are property of R74n.com.
-->
    <meta name="description" content="R74n">
    <meta name="keywords" content="R74n, ryan, RyanUwU, 4755">
    <meta name="author" content="R74n">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:image:alt" content="R74n">
    <meta name="twitter:image" content="https://R74n.com/icons/avatar.png">
    <title>Infinite Chef - R74n</title>
    <script type="application/ld+json">{"@context" : "http://schema.org","@type" : "Organization","name" : "R74n","url" : "https://r74n.com","sameAs" : ["https://twitter.com/R74nCom","https://twitter.com/CopyPasteDump","https://www.youtube.com/channel/UCzS6ufDfiDxbHVL001GwFeA"], "logo":"https://r74n.com/icons/favicon.png", "email":"contact@r74n.com"}</script>
    <link rel="stylesheet" type="text/css" href="../normalize.css">
    <link rel="stylesheet" type="text/css" href="../stylesheet.css">
    <link rel="apple-touch-icon" sizes="180x180" href="https://R74n.com/icons/apple-touch-icon.png?v=R74n-2">
    <link rel="icon" type="image/png" sizes="32x32" href="https://R74n.com/icons/favicon-32x3.png?v=R74n-2">
    <link rel="icon" type="image/png" sizes="16x16" href="https://R74n.com/icons/favicon-16x16.png?v=R74n-2">
    <link rel="manifest" href="https://R74n.com/manifest.json">
    <link rel="mask-icon" href="https://R74n.com/icons/safari-pinned-tab.svg?v=R74n-2" color="#1cd2d2">
    <link rel="shortcut icon" href="https://R74n.com/icons/favicon.ico?v=R74n-2">
    <meta name="msapplication-TileColor" content="#00ffff">
    <meta name="theme-color" content="#00ffff">
    <meta name="msapplication-config" content="https://R74n.com/icons/browserconfig.xml?v=R74n-2">

    <script src="https://R74n.com/load.js"></script>

    <script src="foodData.js"></script>

    <style>
      .content {
        margin: 0;
      }
      @font-face {
        font-family: 'VT323';
        src: url('fonts/VT323-Regular.ttf') format('truetype');
      }
      #gameDiv {
        font-family: 'VT323';
        text-align: center;
        margin: auto;
        display: flex;
        flex-direction: row;
        border: solid 3px #614202;
        box-sizing: border-box;
        background-color: #614202;
        text-shadow: 0px 3px 4px rgba(0,0,0,0.25);
      }
      #gameCanvas {
        background-color: #e3d5ba;
        width: 100%;
        /* background image background.png, tiled, pixel art */
        background-image: url('background.png');
        background-size: 200px 200px;
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
        user-select: none;
      }
      #loadingScreen {
        background-color: #e3d5ba;
        width: 100%;
        height: 100%;
        display: flex;
        color: black;
        align-items: center;
        justify-content: center;
        z-index: 10;
      }
      #mainDiv {
        flex-direction: column;
      }
      #rightDiv {
        display: flex;
        flex-direction: column;
        background-color: #edebe6;
        height: 100%;
        border-left: solid gray 3px;
      }
      #controlsBar {
        display: flex;
        align-items: stretch;
        flex-direction: column;
        flex-grow: 1;
        height: 100%;
        box-shadow: -3px 0px 4px rgba(0,0,0,0.25);
        z-index: 7;
        user-select: none;
      }
      #controlsBar button {
        flex-grow: 1;
        border-radius: 0;
        margin: 0;
        box-shadow: none;
        border-bottom: 3px solid gray;
        background-color: #edebe6;
        color: black;
        box-sizing: border-box;
        max-height: unset;
        position: relative;
      }
      #controlsBar button img {
        /* shadow */
        filter: drop-shadow(0px 2px 1px rgba(0,0,0,0.25));
        width: 2.5em;
      }
      #controlsBar button[selected] {
        background-color: #fff782;
        color: white;
      }
      /* last button no border */
      #controlsBar button:last-child {
        border-bottom: none;
      }
      #prepBar {
        background-color: #9b6723;
        padding: 7.5px;
        border-bottom: solid 3px #614202;
        box-sizing: border-box;
        box-shadow: 0px 3px 4px rgba(0,0,0,0.25);
        z-index: 5;
        position: relative;
        /* background-image: url('wood.png');
        background-size: 100px 100px; */
      }
      #prepBar ::placeholder {
        color: #614202;
        text-shadow: none;
        opacity: 1; /* Firefox */
      }
      #prepBar ::-ms-input-placeholder { /* Edge 12 -18 */
        color: #614202;
        text-shadow: none;
      }
      #prepText {
        width: 100%;
        height: 100%;
        padding: 0;
        background-color: rgba(0, 0, 0, 0);
        border: none;
        color: white;
        text-align: left;
        border-radius: 0;
        font-size: 30px;
        text-shadow: 0px 3px 4px rgba(0,0,0,0.25);
      }
      #searchResultsDiv {
        position: absolute;
        display: none;
        top: 48px;
        width: 100%;
        left: 0px;
        background-color: #9b6723;
        border-bottom: solid 3px #614202;
        box-sizing: border-box;
        box-shadow: 0px 3px 4px rgba(0,0,0,0.25);
        max-height: 10em;
        overflow-y: scroll;
        z-index: 6;
      }
      /* inside #searchResults, have up to 5 searchResult divs side by side */
      #searchResults {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
      }
      .searchResult {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 5px;
        box-shadow: 0px 3px 4px rgba(0,0,0,0.25);
        border: solid 1px #775104;
        cursor: pointer;
        background-color: #9b6723;
        flex-grow: 1;
      }
      .searchResult:hover {
        background-color: rgb(183, 130, 25);
      }
      .searchResult img {
        width: 2em;
        height: 2em;
        image-rendering: pixelated;
        image-rendering: -moz-crisp-edges;
        image-rendering: crisp-edges;
        -webkit-filter: drop-shadow(0px 3px 4px rgba(0,0,0,0.25));
        filter: drop-shadow(0px 3px 4px rgba(0,0,0,0.25));
      }
      .searchResult span {
        font-size: 20px;
      }


      /* mobile */
      @media (max-width: 700px) {
        #gameDiv {
          width: 100%;
          height: 100%;
        }
      }
      /* desktop */
      @media (min-width: 700px) {
      }
    </style>

</head>
<body>


<a href="https://R74n.com" class="backbutton">⦉</a>
<h1 class="pagetitle">Infinite Chef</h1>
<div class="content">


<div id="gameDiv">
  <div id="mainDiv" style="display: none;">
    <div id="prepBar">
      <input type="text" id="prepText" placeholder="Search ingredients..." autocomplete="off">
      <div id="searchResultsDiv">
        <div id="searchResults"></div>
      </div>
    </div>
    <canvas id="gameCanvas"></canvas>
  </div>
  <div id="rightDiv" style="display: none;">
    <div id="controlsBar">
      <button selected id="button-bowl" onclick="changeView('bowl')"><img src="../shapes/png/semicircle_bottom.png" class="pixelart"></button>
      <button id="button-stack" onclick="changeView('stack')"><img src="../shapes/png/stack.png" class="pixelart"></button>
      <button id="button-stove" onclick="changeView('stove')"><img src="../shapes/png/flame.png" class="pixelart"></button>
      <button id="button-blend" onclick="changeView('blend')"><img src="../shapes/png/liquid.png" class="pixelart"></button>
    </div>
  </div>
  <div id="loadingScreen">
    Preparing Kitchen...
  </div>
</div>
<script>
  function refreshCanvas() {
    canvas.width = gameDiv.clientWidth - document.getElementById('controlsBar').clientWidth;
    canvas.height = gameDiv.clientHeight - document.getElementById('prepBar').clientHeight - 2;
    ctx.webkitImageSmoothingEnabled = false;
    ctx.mozImageSmoothingEnabled = false;
    ctx.imageSmoothingEnabled = false;
    drawCanvas();
  }
  var canvas = document.getElementById('gameCanvas');
  var gameDiv = document.getElementById('gameDiv');
  var mainDiv = document.getElementById('mainDiv');
  var rightDiv = document.getElementById('rightDiv');
  var ctx = canvas.getContext('2d');
  canvas.width = Math.min(700, window.innerWidth);
  canvas.height = 500;
  // set to pixelated rendering
  ctx.webkitImageSmoothingEnabled = false;
  ctx.mozImageSmoothingEnabled = false;
  ctx.imageSmoothingEnabled = false;
  gameDiv.style.height = canvas.height + 'px';
  gameDiv.style.width = canvas.width + 'px';
  mainDiv.style.height = canvas.height + 'px';
  mainDiv.style.width = canvas.width + 'px';
  if (window.innerWidth < 700) {
    // mobile scripts
  }
  else {
    // desktop scripts
  }
  fps = 40;
  gameLoop = null;
  ticks = 0;
  function tick() {
    if (!leftBound) {
      if (viewInfo[currentView] !== undefined && viewInfo[currentView].hitbox) {
        var bowlImg = loadImage(viewInfo[currentView].image);
        leftBound = Math.round(canvas.width/2 - bowlImg.width/2*5) + 50;
        rightBound = Math.round(canvas.width/2 + bowlImg.width/2*5) - 50;
        hitLine = Math.round(bowlImg.height*3 + canvas.height/2 - bowlImg.height/2*5+75);
      }
    }
    drawCanvas();
    ticks++;
  }
  imageCache = {};
  searchTimeout = null;
  currentIngredient = "";
  currentView = "bowl";
  viewData = {};
  controlState = {};
  mousePos = {x: 0, y: 0};
  foodScale = 2.25;
  function loadImage(src) {
    if (imageCache[src] == undefined) {
      imageCache[src] = new Image();
      imageCache[src].loaded = false;
      imageCache[src].onload = function() {
        this.loaded = true;
      }
      imageCache[src].src = src;
    }
    return imageCache[src];
  }
  function drawImageSized(src, top_left, bottom_right) {
    var img = loadImage(src);
    // draw image based on percentage of canvas
    ctx.drawImage(img, top_left[0] * canvas.width, top_left[1] * canvas.height, (bottom_right[0] - top_left[0]) * canvas.width, (bottom_right[1] - top_left[1]) * canvas.height);
  }
  function rgbToHsl(r, g, b) {
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b), min = Math.min(r, g, b);
    var h, s, l = (max + min) / 2;
    if (max == min) {
      h = s = 0; // achromatic
    } else {
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }
    return [h, s, l];
  }
  function hslToRgb(h, s, l) {
    var r, g, b;
    if (s == 0) {
      r = g = b = l; // achromatic
    } else {
      var hue2rgb = function hue2rgb(p, q, t) {
        if (t < 0) t += 1;
        if (t > 1) t -= 1;
        if (t < 1 / 6) return p + (q - p) * 6 * t;
        if (t < 1 / 2) return q;
        if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
        return p;
      }
      var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
      var p = 2 * l - q;
      r = hue2rgb(p, q, h + 1 / 3);
      g = hue2rgb(p, q, h);
      b = hue2rgb(p, q, h - 1 / 3);
    }
    return [r * 255, g * 255, b * 255];
  }
  function colorizeImage(src,h,s,l) {
    var name = src+h+","+s+","+l;
    if (imageCache[name]) { return imageCache[name]; }
    var img = loadImage(src);
    var canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    var ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);
    if (!img.loaded) {
      if (!img.loadpilled) {
        img.addEventListener('load', function() {
          colorizeImage(src,h,s,l).src;
        });
        img.loadpilled = true;
      }
      img.id = name;
      return img;
    }
    var imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    for (var i = 0; i < imgData.data.length; i += 4) {
      var rgb = [imgData.data[i], imgData.data[i+1], imgData.data[i+2]];
      var hsl = rgbToHsl(rgb[0], rgb[1], rgb[2]);
      hsl[0] = Math.min(1, Math.max(0, hsl[0] + h));
      hsl[1] = Math.min(1, Math.max(0, hsl[1] + s));
      if (hsl[2] > 0.2 || l < hsl[2]) {
        hsl[2] = Math.min(1, Math.max(0, hsl[2] + l));
      }
      rgb = hslToRgb(hsl[0], hsl[1], hsl[2]);
      imgData.data[i] = rgb[0];
      imgData.data[i+1] = rgb[1];
      imgData.data[i+2] = rgb[2];
    }
    ctx.putImageData(imgData, 0, 0);
    imageCache[name] = new Image();
    imageCache[name].src = canvas.toDataURL();
    imageCache[name].id = name;
    return imageCache[name];
  }
  function colorizeStandard(src,h,s,l) {
    return colorizeImage(src, (h/360), (s/100-0.87), (l/100-0.56))
  }
  var imgPath = "https://r74n.com/cook/";
  function drawCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (viewRenderer[currentView] !== undefined) { viewRenderer[currentView]() }
    tickPlaced();
    // draw a blue rectangle at the bottom of the bowl for its hitbox
    // if (viewInfo[currentView] !== undefined && viewInfo[currentView].hitbox) {
    //   var bowlImg = loadImage(viewInfo[currentView].image);
    //   var hitbox = viewInfo[currentView].hitbox;
    //   ctx.fillStyle = "rgba(0,0,255,0.5)";
    //   // relative to bowlImg width and height and its position on canvas, topleft = 0, topright = 1, bottomright = 2, bottomleft = 3, height = 4
    //   ctx.fillRect(bowlImg.width*hitbox[0] + canvas.width/2 - bowlImg.width/2*5, bowlImg.height*hitbox[1] + canvas.height/2 - bowlImg.height/2*5+75, bowlImg.width*hitbox[2], bowlImg.height*hitbox[4]);
    // }
  }
  function drawPlaced() {
    // loop through viewData[currentView].total and draw each at their x and y
    for (var i = 0; i < viewData[currentView].total.length; i++) {
      var placed = viewData[currentView].total[i];
      if (ingredientAttr(placed.id, "behavior") > 0) {
        var shape = "dots_some";
      }
      else {
        var shape = ingredients[placed.id].shape;
      }
      var ingredientImg = colorizeStandard("../shapes/png/"+shape+".png", ingredients[placed.id].h, ingredients[placed.id].s, ingredients[placed.id].l);
      if (ingredientImg.loaded === false) { continue; }
      ctx.drawImage(ingredientImg, placed.x - ingredientImg.width/2*foodScale, placed.y - ingredientImg.height/2*foodScale, ingredientImg.width*foodScale, ingredientImg.height*foodScale);
    }
  }
  function placeIngredient(ingredient, x, y) {
    var info = ingredients[ingredient];
    if (info.behavior > 0) {
      var size = 5;
    }
    else {
      var size = 32*foodScale;
    }
    viewData[currentView].total.push({id:ingredient, x:x, y:y, h:size, w:size});
  }
  function deleteIngredient(placed) {
    for (var i = 0; i < viewData[currentView].total.length; i++) {
      if (viewData[currentView].total[i] === placed) {
        viewData[currentView].total.splice(i, 1);
        break;
      }
    }
  }
  function containIngredient(placed) {
    var info = ingredients[placed.id];
    var behavior = ingredientAttr(placed.id, "behavior");
    if (behavior > 0) {
      placed.done2 = true;
      if (behavior === 1 && viewInfo[currentView].holdsLiquid) {
        viewData[currentView].liquid++;
        var rgb = hslToRgb(info.h/360, info.s/100, info.l/100);
        viewData[currentView].liquidR += rgb[0];
        viewData[currentView].liquidG += rgb[1];
        viewData[currentView].liquidB += rgb[2];
        deleteIngredient(placed);
      }
    }
    else {
      placed.done = true;
    }
  }
  function tickPlaced() {
    if (viewInfo[currentView] !== undefined && viewInfo[currentView].hitbox) {
      var bowlImg = loadImage(viewInfo[currentView].image);
      var hitbox = viewInfo[currentView].hitbox;
    }
    else {var hitbox = null}
    for (var i = 0; i < viewData[currentView].total.length; i++) {
      var placed = viewData[currentView].total[i];
      var behavior = ingredientAttr(placed.id, "behavior");
      if (placed.done || placed.done2) { continue; }
      if (placed.vx === undefined) { placed.vx = 0; }
      else if (placed.vx) { placed.x += placed.vx; }
      if (placed.vy === undefined) { placed.vy = 0; }
      else if (placed.vy) { placed.y += placed.vy; }
      placed.vy += 0.5;
      if (Math.random() < 0.25) {
        // check collision with other placed
        for (var j = 0; j < viewData[currentView].total.length; j++) {
          if (i === j) { continue; }
          var other = viewData[currentView].total[j];
          if (placed.x < other.x + other.w/1.5 &&
            placed.x + placed.w/1.5 > other.x &&
            placed.y < other.y + other.h/1.5 &&
            placed.y + placed.h/1.5 > other.y) {
            // collision
            // bounce in opposite direction
            if (other.done && placed.y > canvas.height/2 && placed.y < other.y && placed.x > leftBound && placed.x < rightBound) {
              containIngredient(placed);
            }
            else if (placed.x < other.x) {
              placed.vx = -(Math.random()*4+1);
            }
            else {
              placed.vx = (Math.random()*4+1);
            }
          }
        }
        // if its outside the canvas, remove it
        if (placed.x < 0 || placed.x > canvas.width || placed.y > canvas.height) {
          viewData[currentView].total.splice(i, 1);
          i--;
        }
      }
      // check collision with the bowl
      // equations: ctx.fillRect(bowlImg.width*hitbox[0] + canvas.width/2 - bowlImg.width/2*5, bowlImg.height*hitbox[1] + canvas.height/2 - bowlImg.height/2*5+75, bowlImg.width*hitbox[2], bowlImg.height*hitbox[4]);
      // if inside hitbox, set done to true
      if (hitLine) {
        // if the bottom of the placed is below the hitline, set done true
        if (placed.y + placed.h/2 >= hitLine && placed.y + placed.h/2 < hitLine+20 && placed.x > leftBound && placed.x < rightBound) {
          containIngredient(placed);
        }
      }
    }
  }
  function checkCollision(placed,i) {
    for (var j = 0; j < viewData[currentView].total.length; j++) {
      if (i === j) { continue; }
      var other = viewData[currentView].total[j];
      if (placed.x < other.x + other.w &&
        placed.x + placed.w > other.x &&
        placed.y < other.y + other.h &&
        placed.y + placed.h > other.y) {
        // collision
        return true;
      }
    }
    return false;
  }
  viewRenderer = {
    "bowl": function() {
      // draw from file table.png to fit the whole canvas
      ctx.drawImage(loadImage('table.png'), 0, 0, canvas.width, canvas.height);
      // put in the middle on the table
      // drawImageSized("bowl.png", [0.25, 0.4], [0.75, 0.75]);
      ctx.shadowOffsetY = 7;
      ctx.shadowColor = "black";
      ctx.shadowBlur = 20;
      var bowlImg = loadImage('bowl.png');
      ctx.drawImage(bowlImg, canvas.width/2 - bowlImg.width/2*5, canvas.height/2 - bowlImg.height/2*5+75, bowlImg.width*5, bowlImg.height*5);
      ctx.shadowColor = "transparent";
      if (viewData.bowl.liquid) {
        var liquidColor = [viewData.bowl.liquidR/viewData.bowl.liquid, viewData.bowl.liquidG/viewData.bowl.liquid, viewData.bowl.liquidB/viewData.bowl.liquid]
        var hsl = rgbToHsl(liquidColor[0], liquidColor[1], liquidColor[2]);
        liquidColor = [hsl[0]*360, hsl[1]*100, hsl[2]*100];
        // var liquidImg = colorizeStandard('bowl_liquid.png', 180, 27, 35);
        var liquidImg = colorizeStandard('bowl_liquid.png', liquidColor[0], liquidColor[1], liquidColor[2]);
        ctx.drawImage(liquidImg, canvas.width/2 - liquidImg.width/2*5, canvas.height/2 - liquidImg.height/2*5+75, liquidImg.width*5, liquidImg.height*5);
      }
      drawPlaced();
      // draw transparent ingredient at mousePos
      if (currentIngredient) {
        ctx.globalAlpha = 0.5;
        var ingredientImg = colorizeStandard("../shapes/png/"+ingredients[currentIngredient].shape+".png", ingredients[currentIngredient].h, ingredients[currentIngredient].s, ingredients[currentIngredient].l);
        ctx.drawImage(ingredientImg, mousePos.x - ingredientImg.width/2*foodScale, mousePos.y - ingredientImg.height/2*foodScale, ingredientImg.width*foodScale, ingredientImg.height*foodScale);
        ctx.globalAlpha = 1;
      }
      if (viewData.bowl.liquid) {
        ctx.globalAlpha = 0.75;
        var liquidImg2 = colorizeStandard('bowl_liquid_front.png', liquidColor[0], liquidColor[1], liquidColor[2]);
        ctx.drawImage(liquidImg2, canvas.width/2 - liquidImg.width/2*5, canvas.height/2 - liquidImg.height/2*5+75, liquidImg.width*5, liquidImg.height*5);
        ctx.globalAlpha = 1;
      }
      var bowlImg2 = loadImage('bowl_front.png');
      ctx.drawImage(bowlImg2, canvas.width/2 - bowlImg.width/2*5, canvas.height/2 - bowlImg.height/2*5+75, bowlImg.width*5, bowlImg.height*5);
      // draw line in yellow
      // ctx.fillStyle = "rgba(255,255,0)";
      // ctx.fillRect(leftBound, hitLine, rightBound - leftBound, 5);
    }
  }
  viewInfo = {
    "bowl": {
      "image": "bowl.png",
      "hitbox": [0.5,3,4,1,0.5],
      "holdsLiquid": true
    }
  }
  leftBound = 0;
  rightBound = 0;
  hitLine = 0;
  function changeView(view) {
    currentView = view;
    document.getElementById('controlsBar').querySelectorAll('button[selected]').forEach(function(button) {
      button.removeAttribute('selected');
    });
    document.getElementById('controlsBar').querySelector('#button-'+view).setAttribute('selected', '');
    if (!viewData[view]) {
      viewData[view] = {"total":[],"contained":[]};
      if (viewInfo[view] !== undefined && viewInfo[view].holdsLiquid) {
        viewData[view].liquid = 0;
        viewData[view].liquidR = 0;
        viewData[view].liquidG = 0;
        viewData[view].liquidB = 0;
      }
    }
  }
  changeView('bowl');
  refreshCanvas();
  // window.addEventListener('resize', refreshCanvas);

  function selectIngredient(ingredient,drop) {
    currentIngredient = ingredient;
    if (!ingredient || !ingredients[ingredient]) { return; }
    document.getElementById('prepText').value = formatName(ingredient);
    if (drop) {
      // random number from leftBound to rightBound
      var x = Math.random() * (rightBound - leftBound) + leftBound;
      placeIngredient(ingredient, x, 0);
    }
  }
  function formatName(ingredient) {
    if (ingredients[ingredient] !== undefined && ingredients[ingredient].name) {
      ingredient = ingredients[ingredient].name;
    }
    ingredient = ingredient.replace(/_/g, " ");
    ingredient = ingredient.replace(
      /\w\S*/g,
      function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
      }
    )
    return ingredient;
  }
  function searchIngredients(query) {
    var searchResults = document.getElementById('searchResults');
    selectIngredient("");
    searchResults.innerHTML = "";
    if (!query) { hideSearchResults(); return; }
    var queryO = query;
    query = query.toLowerCase().replace(/ /g, "_");
    if (query === "*test") { query = "" }
    var redo = false;
    var count = 0;
    for (var key in ingredients) {
      if (count > 10) { break; }
      if (key.indexOf(query) != -1) {
        var info = ingredients[key];
        if (info.hidden) { continue; }
        var canvas = colorizeStandard("../shapes/png/"+info.shape+".png", info.h, info.s, info.l);
        var div = document.createElement('div');
        div.className = 'searchResult';
        div.innerHTML = "<img src='"+canvas.src+"'><span>"+formatName(key)+"</span>";
        div.setAttribute('data-ingredient', key);
        div.onclick = function() {
          selectIngredient(this.getAttribute('data-ingredient'));
          document.getElementById('prepText').value = formatName(currentIngredient);
          document.getElementById('searchResultsDiv').style.display = 'none';
          controlState.inMenu = false;
        }
        if (canvas.loaded === false) {
          redo = true;
        }
        else {
          searchResults.appendChild(div);
        }
        count++;
      }
    }
    if (redo) {
      setTimeout(function() {
        searchIngredients(queryO);
      }, 100);
      return;
    }
    if (searchResults.innerHTML.length == 0) {
      searchResults.innerHTML = "<span>No ingredients found... :(</span>";
    }
    showSearchResults();
  }
  function finalizeIngredient(ingredient) {
    var info = ingredients[ingredient];
    if (info.r) {
      var r = info.r;var g = info.g;var b = info.b;
      var hsl = rgbToHsl(r, g, b);
      info.h = hsl[0] * 360;
      info.s = hsl[1] * 100;
      info.l = hsl[2] * 100;
    }
    if (info.rgb) {
      var rgb = info.rgb.split(",");
      var hsl = rgbToHsl(rgb[0], rgb[1], rgb[2]);
      info.h = hsl[0] * 360;
      info.s = hsl[1] * 100;
      info.l = hsl[2] * 100;
    }
    if (info.hsl) {
      var hsl = info.hsl.split(",");
      info.h = hsl[0];
      info.s = hsl[1];
      info.l = hsl[2];
    }
    if (info.color) {
      var color = info.color;
      if (color.charCodeAt(0) == 35) {
        color = color.substring(1);
      }
      var r = parseInt(color.substring(0, 2), 16);
      var g = parseInt(color.substring(2, 4), 16);
      var b = parseInt(color.substring(4, 6), 16);
      var hsl = rgbToHsl(r, g, b);
      info.h = hsl[0] * 360;
      info.s = hsl[1] * 100;
      info.l = hsl[2] * 100;
    }
    if (!info.h) { info.h=0 }
    if (!info.s) { info.s=0 }
    if (!info.l) { info.l=50 }
    if (!info.shape) {
      info.shape = ingredientAttr(ingredient, "shape") || "rhombus";
    }
    if (!info.group) {
      var parentGroup = ingredientAttr(ingredient, "group");
      if (!parentGroup || parentGroup === "generic") {
        info.group = "other";
      }
    }
    if (info.group === "generic") { info.hidden = true }
  }
  function ingredientAttr(ingredient, attr) {
    if (ingredients[ingredient] === undefined) { return undefined; }
    if (ingredients[ingredient][attr] === undefined) {
      if (ingredients[ingredient].type) {
        return ingredientAttr(ingredients[ingredient].type, attr);
      }
    }
    else {
      return ingredients[ingredient][attr];
    }
    return undefined;
  }

  window.addEventListener('load', function(){
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('mainDiv').style.display = 'flex';
    document.getElementById('rightDiv').style.display = 'flex';
    var gameCanvas = document.getElementById('gameCanvas');
    var rightDiv = document.getElementById('rightDiv');
    var prepBar = document.getElementById('prepBar');
    var prepText = document.getElementById('prepText');
    var searchResults = document.getElementById('searchResultsDiv');

    // Event Listeners
    hideSearchResults = () => {
      document.getElementById('searchResultsDiv').style.display = 'none';
      controlState.inMenu=false;
      if (currentIngredient) { prepText.value = formatName(currentIngredient); }
    }
    showSearchResults = () => {document.getElementById('searchResultsDiv').style.display = 'block'; ; controlState.inMenu=true}
    prepText.addEventListener('focus', function(e) {
      if (document.getElementById('searchResults').innerHTML) { showSearchResults(); }
      this.value = "";
      // searchIngredients(this.value)
    });
    prepText.addEventListener('input', function(e) {
      if (this.value.length === 0) { hideSearchResults(); selectIngredient(null); return }
      document.getElementById('searchResults').innerHTML = "Searching... :)";
      showSearchResults();
      // timeout to prevent spamming
      if (searchTimeout) { clearTimeout(searchTimeout); }
      searchTimeout = setTimeout(function() {
        searchIngredients(prepText.value);
      }, 250);
    });
    prepBar.addEventListener('click', function(e) {
      e.stopPropagation();
    });
    document.body.addEventListener('click', hideSearchResults);
    window.addEventListener('keydown', function(e) {
      if (e.keyCode == 16) { controlState.shift = true; }
    });
    window.addEventListener('keyup', function(e) {
      if (e.keyCode == 16) { controlState.shift = false; }
    });
    window.addEventListener('blur', function(e) {
      controlState.shift = false;
      controlState.mouse = false;
    });
    function updateMouse(e) {
      // get mouse position on canvas
      var rect = gameCanvas.getBoundingClientRect();
      mousePos = {
        x: Math.round(e.clientX - rect.left),
        y: Math.round(e.clientY - rect.top)
      }
    }
    window.addEventListener('mousemove', function(e) {
      // get mouse position on canvas
      updateMouse(e);
      // if (controlState.mouse === 0) {
      //   if (currentIngredient) {
      //     placeIngredient(currentIngredient, mousePos.x, mousePos.y);
      //   }
      // }
    });
    gameCanvas.addEventListener('mousedown', function(e) {
      updateMouse(e);
      if (controlState.inMenu) { return; }
      controlState.mouse = e.button;
      if (e.button === 0) {
        if (currentIngredient) {
          placeIngredient(currentIngredient, mousePos.x, mousePos.y);
        }
      }
      if (controlState.shift) {
        console.log(mousePos.x/canvas.width,mousePos.y/canvas.height);
      }
    });
    gameCanvas.addEventListener('mouseup', function(e) {
      controlState.mouse = false;
    });
    window.addEventListener('mouseup', function(e) {
      controlState.mouse = false;
    });

    // Initialization
    for (var key in ingredients) {
      finalizeIngredient(key);
    }
    refreshCanvas();
    gameLoop = setInterval(tick, 1000 / fps);
  });
</script>







</div>


<!-- i like having this but ublock blocks these things anyway -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-93720349-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93720349-6');
</script>

</body>
</html>